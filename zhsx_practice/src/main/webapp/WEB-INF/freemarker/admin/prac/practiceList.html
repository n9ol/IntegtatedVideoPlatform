<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <title>试卷管理</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <#include "/commons/comAdmin.html" encoding="utf-8"/>
    </head>
<body>
<section class="layui-larry-box">
	<div class="larry-personal">
	    <div class="layui-tab">
            <blockquote class="layui-elem-quote mylog-info-tit" style="height:80px;">

                <form class="layui-form col-lg-10 search-box03" action="" method="post">
                   <div class="layui-input-inline pull-left">
                      <input type="text" id="searchTitle" name="searchTitle" placeholder="标题" class="layui-input" value="${wq.searchTitle!''}"/> 
<!--                       <input type="text" id="title" name="title" placeholder="标题" class="layui-input" value="{wq.title!''}"/>  -->
                    </div>
                      <div class="layui-input-inline pull-left">
<!--                       <input type="text" id="nickName" name="nickName" placeholder="出题人" class="layui-input" value="{wq.nickName!''}"/> -->
                                        <input type="hidden" id="nickName" name="nickName" placeholder="出题人" class="layui-input" value=""/>
                    </div>  
                        
                    <button class="layui-btn search-btn01 pull-left" lay-submit lay-filter="search">搜索</button>
                   <a class="layui-btn layui-btn-primary   pull-left" style="margin:0 30px 0 30px;" href="${ctx}/adminPractice/practiceList?p=${pageNum!'1'}">
				    重置
				     </a>
<!-- 				      <button type="reset" class="layui-btn layui-btn-primary">重置</button> -->
                    
                </form>
                <!-- 放在里面容易自动提交页面 -->
                <button class="layui-btn layui-btn-warm search-btn01 pull-left" onclick="add();">添加</button>
	
                <a class="layui-btn pull-right refresh_btn" style="margin:0 30px 0 30px;" href="${ctx}/adminPractice/practiceList?p=${pageNum!'1'}">
                    <i class="iconfont icon-shuaxin"></i> 
                </a>
            </blockquote>
            <div class="larry-separate"></div>
		    <div class="layui-tab-content larry-personal-body clearfix">

                <table class="layui-table table-hover text-center" lay-even="">
                    <thead>
                    <tr>
                        <th>No</th>
						<th>标题</th>
						<th>年级</th>
						<th>科目</th>
                        <th>创建人</th>
                        <th>创建时间</th>
                        <th>预览</th>
                        <th>上课教室</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
 					<#if lists?? && (lists?size>0)>
                       		<#list lists as l>
                       			<tr>
		                            <td>${(l_index+1)!''}</td>
		                            <td style="width:300px; word-break: break-all; word-wrap:break-word;">${l.title!''}</td>
		                            <td>${l.gradeName!''}</td>
		                            <td>${l.subjectName!''}</td>
		                            <td>${l.createId!''}</td>
		                            <td><#if l.createTime??> ${(l.createTime!'')?string("yyyy-MM-dd HH:mm:ss")}</#if></td>
									<td>
										<a class="check_look"   href="javascript:question('${(l.id)!''}');" >
		                                    		<i class="layui-icon">&#xe633;</i>&nbsp;预览试题
		                                </a>
									</td>
		                            <td>
										<a class="check_look" title="选择教室" href="javascript:selectClassRoom('${(l.id)!''}');">
		                                	<i class="layui-icon">&#xe642;</i>&nbsp;选择教室
		                                </a>
									</td>
		                            <td>
		                                <a class="check_look" title="编辑" href="javascript:practiceEdu('${(l.id)!''}');" >
		                                     		<i class="layui-icon">&#xe642;</i>&nbsp;编辑
		                                </a>
		                                <a class="check_look" title="删除" href="javascript:deleteById('${(l.id)!''}');">
		                                    <i class="layui-icon">&#xe640;</i>&nbsp;删除
		                                </a>
		                            </td>
		                        </tr>
							</#list>
						</#if>
                    </tbody>
                </table>
				<div id="page"></div>
		    </div>
		</div>
		
			<form id="myform1" action="${ctx}/adminPractice/practiceList" method="post">
				<input type="hidden" name="p" value="${pageNum!'1'}"> 
<!-- 				<input type="hidden" name="searchTitle" value="${searchTitle!''}"> -->
<!-- 				<input type="hidden" name="searchNickName" value="searchNickName''}"> -->
			</form>
		
	</div>
</section>
	<script type="text/javascript" src="${ctx}/common/layui/lay/modules/laypage.js"></script>
<script type="text/javascript">

    layui.use(['form','upload'],function(){
        var form = layui.form();
        layui.upload({
            url: '' ,//上传接口
            success: function(res){//上传成功后的回调
                console.log(res);
            }
        });
        
        form.on('submit(search)', function(data){
        	 var searchTitle = $("#searchTitle").val();
	    	 var nickName = $("#nickName").val();
		 window.location.href="${ctx}/adminPractice/practiceList?p=${pageNum!'1'}&searchTitle="+searchTitle+"&nickName="+nickName;
   	    // 	 refresh();//手动刷新
   	   	 return false; //禁止 页面自动刷新
        });
    });
    
    var laypage = layui.laypage;
	laypage({
		  cont: "page",pages: "${pages!'1'}",curr: "${pageNum!'1'}",skip: false,skin: "molv",groups: 10, 
		  jump: function(e, first){ 
		    if(!first){ 
		    	 var searchTitle = $("#searchTitle").val();
		    	 var nickName = $("#nickName").val();
					
			 window.location.href="${ctx}/adminPractice/practiceList?p="+e.curr+"&searchTitle="+searchTitle+"&nickName="+nickName;

		    }
		  }
	});
	
	function add(){
		LayerOpen('添加', '900px', '500px', '${ctx}/adminPractice/addPractice');
	}
	function practiceEdu(id){
		LayerOpen('编辑', '900px', '500px', '${ctx}/adminPractice/practiceEdu?id='+id);
	}
	function deleteById(id){
		layer.confirm('确定要删除?', {icon: 3, title:'提示'}, function(index){
  		layer.close(index); 
  		if((id==null) || (typeof(id)=='undefined') || (id=="")){
  			layer.msg('信息主键不存在，删除失败！', {icon: 5});
  		}else{
  			layer.msg('删除成功！', {icon: 6});
  			$.ajax({
  				url: "${ctx}/adminPractice/delPractice",
  				type: "post",
  				data: {"qid":id},
  				success: function(data){
  					if(data=='操作成功'){
  						layer.msg(data, {icon: 6});
  	  					refresh();//手动刷新  有问题
  					}else{//id不为空
  						layer.msg(data, {icon: 5});
  					}
  				}
  			}); 
  		}

        });
	}
	
	function question(qid){
		window.location.href="${ctx}/adminPractice/findAllQues?pid="+qid;
	}
	function selectClassRoom(id){
		window.location.href="${ctx}/adminPractice/timetable?pid="+id;
	}
	/*发布*/
	function fabu(qid){
		
		layer.confirm('调查问卷只能发布一套，其他问卷将被弃用，确定要发布该问卷吗?', {icon: 3, title:'提示'}, function(index){
	  		layer.close(index); 
	  		if((qid==null) || (typeof(qid)=='undefined') || (qid=="")){
	  			layer.msg('信息主键不存在，操作失败！', {icon: 5});
	  		}else{
	  			layer.msg('操作成功！', {icon: 6});
	  			$.ajax({
	  				url: "${ctx}/adminPractice/addFabu",
	  				type: "post",
	  				data: {"qid":qid},
	  				success: function(data){
	  					if(data=='操作成功'){
	  						layer.msg(data, {icon: 6});
	  	  					refresh();//手动刷新  有问题
	  					}else{//id不为空
	  						layer.msg(data, {icon: 5});
	  					}
	  				}
	  			}); 
	  		}

	        });
		
	}
	/*取消发布*/
	function cancelFabu(qid){
		
		layer.confirm('确定?', {icon: 3, title:'提示'}, function(index){
	  		layer.close(index); 
	  		if((qid==null) || (typeof(qid)=='undefined') || (qid=="")){
	  			layer.msg('信息主键不存在，操作失败！', {icon: 5});
	  		}else{
	  			layer.msg('操作成功！', {icon: 6});
	  			$.ajax({
	  				url: "${ctx}/adminPractice/cancelFabu",
	  				type: "post",
	  				data: {"qid":qid},
	  				success: function(data){
	  					if(data=='操作成功'){
	  						layer.msg(data, {icon: 6});
	  	  					refresh();//手动刷新  有问题
	  					}else{//id不为空
	  						layer.msg(data, {icon: 5});
	  					}
	  				}
	  			}); 
	  		}

	        });
		
	}
</script>
</body>
</html>