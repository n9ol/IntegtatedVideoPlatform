<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <title>问题管理</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">

         <#include "/commons/comAdmin.html" encoding="utf-8"/>
		<link rel="stylesheet" type="text/css" href="${ctx}/common/bootstrap/css/bootstrap.css" media="all">
        <link rel="stylesheet" type="text/css" href="${ctx}/common/global.css" media="all">
        <link rel="stylesheet" type="text/css" href="${ctx}/css/personal.css" media="all">

    </head>
<body>
<section class="layui-larry-box">
	<div class="larry-personal">
	    <div class="layui-tab">
            <blockquote class="layui-elem-quote mylog-info-tit" style="height:80px;">

                <form id='formMy' class="layui-form col-lg-9 search-box03" action="" method="post">
                    <div class="layui-input-inline pull-left">
                                    <input type="text" id="searchQuestion" name="searchQuestion" placeholder="题目" class="layui-input" value="${wq.searchQuestion!''}"/>
                    </div>
                     
                     <div class="layui-input-inline pull-left"> 
           				<select id ="type" name="type" lay-verify="">   
						<#assign typa=''><#assign typb=''><#assign typc=''><#assign typd=''>
           				<#if (((wq.type)!'') == 'A')><#assign typa="selected='selected'"> </#if>
           				<#if (((wq.type)!'') == 'B')><#assign typb="selected='selected'"> </#if>
           				<#if (((wq.type)!'') == 'C')><#assign typc="selected='selected'"> </#if>
           				<#if (((wq.type)!'') == 'D')><#assign typd="selected='selected'"> </#if>
						  <option value="">请选择类型</option>
						  <option value="A"  ${typa} >单选题</option>
						  <option value="B"  ${typb} >多选题</option>
						  <option value="C"  ${typc} >判断题</option>
						  <option value="D"  ${typd} >主观题</option>
						</select>            
                     </div> 
                    <!-- 试卷id -->
					<input type="hidden" id="pid" name="pid" value="${pid!''}">
                    <button class="layui-btn search-btn01 pull-left" lay-submit lay-filter="search">搜索</button>
                   <a class="layui-btn layui-btn-primary   pull-left" style="margin:0 30px 0 30px;" href="${ctx}/adminPractice/findAllQues?p=${pageNum!'1'}">
				    重置
				    </a>
                    
                </form>
				<button class="layui-btn layui-btn-warm search-btn01 pull-left" onclick="add();">添加题目</button>
				
                <a class="layui-btn pull-left refresh_btn" style="margin:0 30px 0 30px;" href="${ctx}/adminPractice/practiceList?p=${pageNum!'1'}">
                    	返回试卷列表
                </a>
                <!-- 刷新功能 -->
				<a class="layui-btn pull-right refresh_btn" style="margin:0 30px 0 30px;" href="${ctx}/adminPractice/findAllQues?p=${pageNum!'1'}&pid=${pid!''}">
				    <i class="iconfont icon-shuaxin"></i>
				</a>
            </blockquote>
            <div class="larry-separate"></div>
		    <div class="layui-tab-content larry-personal-body clearfix">
		    	
                <table class="layui-table layui-table table-hover text-center" lay-even="" >
                    <thead>
	                    <tr>
	                        <th>No</th>
	                        <th>已出题目</th>
	                        <th>类型</th>
	                        <th >选项</th>
	                        <th >正确选项</th>
	                        <th>操作</th>
	                    </tr>
                    </thead>
                    <tbody>
     					<#if lists?? && (lists?size>0)>
                       		<#list lists as l>
                       			<tr>
		                            <td>${(l_index+1)!''}</td>
		                            <td style="width:800px; word-break: break-all; word-wrap:break-word;">${l.question!''}</td>
		                            <td>
		                            	<#if (l.type!'')=='A'>
		                            		单选题
		                            	<#elseif (l.type!'')=='B'>
		                            		多选题
		                            	<#elseif (l.type!'')=='C'>
		                            		判断题
		                            		<#elseif (l.type!'')=='D'>
		                            		主观题
		                            	<#else>
		                            	
		                            	</#if>
		                            </td>
		                            <td >
		                           		 <a href="javascript:" class="sse"><#if l.bak?? && (l.bak?length>30)> ${l.bak?substring(0,30)}...<#else>  ${l.bak!''}</#if> <span style="display:none;">${l.options!''}</span> </a>
									</td>
									<td>${l.rights!'--'}</td>
		                            <td>
		                            
		                                <a class="check_look" title="删除" href="javascript:deleteById('${(l.id)!''}');">
		                                     		<i class="layui-icon">&#xe640;</i>&nbsp;移除
		                                </a>
		                            </td>
		                        </tr>
							</#list>
						</#if>
                    </tbody>
                </table>
                <div id="page"></div>
		    </div>
		</div>
	</div>
</section>
	<script type="text/javascript" src="${ctx}/common/layui/lay/modules/laypage.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	var tipsi;
	  $(".sse").hover(function(){
		  var aa=$(this).children('span').html();
		  if($(this).text().indexOf("...")>0)
	     tipsi = layer.tips(aa,this, {time:0});//
	   },function(){
			layer.close(tipsi);
	   });
 
});


     
	var $;
	var form;
	var $form; 
	var qid = $("#qid").val();
	
	layui.use(['jquery', 'form'], function() {
		$ = layui.jquery;
		form = layui.form();
		$form = $('form');
		
		
		form.on('submit(search)', function(data){
       	 var type = $("#type").val();
    	 var question = $("#searchQuestion").val();
    	 var pid = $("#pid").val();
	     window.location.href="${ctx}/adminPractice/findAllQues?p=${pageNum!'1'}&type="+type+"&searchQuestion="+question+"&pid="+pid;
   	   	 return false; //禁止 页面自动刷新
		});
 
	});
    
	var keyWord = $("#keyWord").val();
	
	var laypage = layui.laypage;
	laypage({
		  cont: "page",pages: "${pages!'1'}",curr: "${pageNum!'1'}",skip: false,skin: "molv",groups: 5, 
		  jump: function(e, first){ 
		    if(!first){ 
		    	 var type = $("#type").val();
		    	 var question = $("#searchQuestion").val();
		    	 var pid = $("#pid").val();
 		    	window.location.href="${ctx}/adminPractice/findAllQues?p="+e.curr+"&pid="+pid+"&type="+type+"&searchQuestion="+question;
		 //   	window.location.href="${ctx}/adminPractice/findAllQues?qid="+qid;
		    }
		  }
	});
	
	function add(){
		var pid = $("#pid").val();
		LayerOpen('添加', '1300px', '900px', '${ctx}/adminPractice/practiceLibrary2?pid='+pid);
	}
	function findById(id){
		LayerOpen('编辑', '750px', '300px', '${ctx}/testques/findTestQuesById?id='+id);
	}
	function deleteById(id){
		layer.confirm('确定要删除?', {icon: 3, title:'提示'}, function(index){
  		layer.close(index); 
  		if((id==null) || (typeof(id)=='undefined') || (id=="")){
  			layer.msg('信息主键不存在，删除失败！', {icon: 5});
  		}else{
  			
  			$.ajax({
  				url: "${ctx}/adminPractice/deleteQues",
  				type: "post",
  				data: {"id":id},
  				success: function(data){
  					if(data=='操作成功'){
  						layer.msg(data, {icon: 6});
  	  					refresh();//手动刷新  有问题
  					}else{//id不为空
  						layer.msg(data, {icon: 5});
  					}
  				}
  			}); 
  		}

        });
	}
    

	    
	    
</script>
</body>
</html>