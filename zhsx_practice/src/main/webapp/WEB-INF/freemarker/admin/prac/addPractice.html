<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <title>添加试卷</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">

       <#include "/commons/comAdmin.html" encoding="utf-8"/>
		<link rel="stylesheet" type="text/css" href="${ctx}/common/bootstrap/css/bootstrap.css" media="all">
        <link rel="stylesheet" type="text/css" href="${ctx}/common/global.css" media="all">
        <link rel="stylesheet" type="text/css" href="${ctx}/css/personal.css" media="all">
		
    </head>
<body>
<section class="layui-larry-box">
	<div class="larry-personal">
		<div class="larry-personal-body clearfix">
			<form id="form" class="layui-form" action="" method="post">
				<div class="row">
                    <!-- <div class="col-md-8 pull-left"> -->
                        
                        <div class="layui-form-item">
                            <label class="layui-form-label">标题：</label>
                            <div class="layui-input-block">
                                <input type="text" id="title" name="title" placeholder="标题" lay-verify="required" class="layui-input" value="" >
                            </div>
                        </div>
                        <div class="layui-form-item">
                        <label class="layui-form-label">年级：</label>
                        <div class="layui-input-block">
                         <select type="text" id="gradeId" name="gradeName" title="年级" lay-filter="gradeId" lay-verify="required">
								     
								         	<option value="">选择年级</option>
								        <#if grades??&&(grades?size>0)><#list grades as g>
								        	<#if gradeName??>
									        	<#assign grade="">
												<#if gradeName=="${g.value}">
												<#assign grade="selected='selected'">
												</#if>
											<#else>
												<#assign grade="">
											</#if>	
			       							<option  name="${g.id}"  value="${g.id}" ${grade}>${g.value}</option>
			       						</#list></#if>
								      </select>
							  </div>   
							     
                        </div>
                        <div class="layui-form-item">
                         <label class="layui-form-label">科目：</label>
                         <div class="layui-input-block">
									      	<select name="subjectName" class="subjectId" id="subjectId" lay-verify="required">
				        						<option  value="">选择科目</option>
				      						</select>
				      	</div> 
								 </div>
<!--                         <div class="layui-form-item"> -->
<!--                             <label class="layui-form-label">发布时间：</label> -->
<!--                             <div class="layui-input-block"> -->
<!--                                 <input class="layui-input" id="fabutime" name="fabutime" onclick="layui.laydate({elem: this, istime: true, format: 'YYYY-MM-DD hh:mm:ss'})"> -->
<!--                             </div> -->
<!--                         </div> -->
    
                        <div class="layui-form-item">
                            <div class="layui-input-block text-center">
                                <button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                            </div>
                        </div>
                    <!-- </div> -->
                </div>
			</form>
		</div>
	</div>
</section>
<script type="text/javascript">
 
	layui.use(['form','upload','laydate'],function(){
         var form = layui.form();
         var laydate = layui.laydate;
         
         
         form.on('select(gradeId)', function(data){
 			getSubjects(data.value);
 		});
 		function getSubjects(gradeId){
 			$("#subjectId").empty();
 			$("#subjectId").append('<option value="">请选择科目</option>');
 			$.getJSON("${ctx}/adminBaseData/getSubjects", { gradeId: gradeId}, function(json){
 				for (var int = 0; int < json.length; int++) {
 					var arrayJson=json[int];
 					var subjectName = "${subjectName!''}";
 					if(subjectName === arrayJson.value){
 						$("#subjectId").append('<option  value="'+arrayJson.value+'"selected="selected">'+arrayJson.value+'</option>');
 					}else{
 						$("#subjectId").append('<option  value="'+arrayJson.value+'">'+arrayJson.value+'</option>');
 					}
 				}
 				form.render('select');
 			});  
 		}
 		window.onload = function() {
			var grad=$("#gradeId").find("option:selected").val();
			getSubjects(grad);
	    }; 
         
         form.on('submit(add)', function(data){
        	 
        	 var title =  $.trim($("#title").val());
        	 var remarks =  $.trim($("#remarks").val());
        	 if(title== undefined ||title.length>50||title.length==0){
        		 layer.msg("标题长度在50字以内");
        		 return false;
        	 }else{
        		 if( remarks.length>300 ){
        			 layer.msg("问卷说明长度在300字以内");
            		 return false;
        		 }
        		 $.ajax({
     	   			url:"${ctx}/adminPractice/addPracticeData",
     	   			type:'post',
     	   			data:data.field,
     	   			success:function(data){
     	   					layer.msg(data);
     	   		   	     closeiframe(window.name);//关闭当前页面
     	   		   	  	 refresh();//手动刷新
     	   			}
     	   		 });
     	   	  	 
     	   	  	 return false; //禁止 页面自动刷新 
        	 }
        	 return false;
	   	   	
      	});
	});
	
</script>
</body>
</html>