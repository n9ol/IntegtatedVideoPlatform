<!DOCTYPE html>
<html lang="zh-CN">
	<head>
	<meta charset="utf-8">
	<title>添加评估项</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<#include "/commons/comAdmin.html" encoding="utf-8"/>
	<style type="text/css">
	.layui-larry-box {
		padding: 0;
	}
	#jj {
		text-align:right;
		width: 80px;
		float:left;
	}
	.layui-input-block{
		margin-right:200px;
		margin-left: 100px;
	}
	.msg{
		float:right;
		margin-top:-25px;
		width:180px;
	}
	.msg1{
		float:right;
		margin-top:13px;
		width:180px;
	}
	</style>
	</head>
<body>
	<section class="layui-larry-box">
		<div class="larry-personal">
			<div class="larry-personal-body clearfix">
				<form id="form" class="layui-form">
					<div class="row">
						<div class="layui-form-item">
	                      <label class="layui-form-label" id="jj">评估项：</label>
<!-- 	                      <div class="layui-input-inline" style="margin-left:20px;width:150px;"> -->
<!-- 	                          <select  id="pgtype"  lay-filter="pgtype"> -->
<!--                          		  <option value="">请选择分类</option> -->
<!-- 								  <option value="F">课前</option> -->
<!-- 								  <option value="I">课中</option> -->
<!-- 	                          </select> -->
<!-- 	                      </div> -->
	                      <div class="layui-input-inline" style="margin-left:20px;width:150px;">
	                          <select id="pjinfoId" name="pjinfoId" lay-search>
	                              <option value="">请选择评估项</option>
	                          </select>
	                      </div>
	                      <span id="pjinfoId_msg" class="msg1" style="color:red;">*</span>
		                </div>
						<div class="layui-form-item">
							<label class="layui-form-label" id="jj">评估内容：</label>
							<div class="layui-input-block">
								<input type="text" id="content" name="content" class="layui-input" title="评估内容" onblur="checkOk(this,checkString(this))">
							</div>
							<span id="content_msg" class="msg" style="color:red;">*</span>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label" id="jj">权重：</label>
							<div class="layui-input-block">
								<input type="text" id="weight" name="weight" class="layui-input" title="权重" onblur="checkOk(this,checkString(this)&&checkNum(this))">
							</div>
							<span id="weight_msg" class="msg" style="color: red;">*</span>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label" id="jj">序号：</label>
							<div class="layui-input-block">
								<input type="text" id="bak" name="bak" class="layui-input" title="序号" onblur="checkOk(this,checkString(this)&&checkNum(this))">
							</div>
							<span id="bak_msg" class="msg" style="color: red;">*</span>
						</div>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<input type="button" class="layui-btn" onclick="javascript:submitForm();" value="立即提交">
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</section>
</body>
<script type="text/javascript">
	var layer;
	layui.use([ 'layer','form'], function() {
		layer = layui.layer;
		var form = layui.form();
		
		$(function(){
			getpjinfo("I");
		});
		
		function getpjinfo(type){
			$("input[name='type']").val(type);
			$("#pjinfoId").empty();
			$("#pjinfoId").append('<option value="">请选择评估项</option>');
				$.getJSON("${ctx}/getPjInfoByType", {type: type}, function(json){
	 			for (var int = 0; int < json.length; int++) {
					var arrayJson=json[int];
					$("#pjinfoId").append('<option value="'+arrayJson.id+'">'+arrayJson.title+'</option>');
	 			}
	 			form.render('select');
			}); 
		}
		
	});

	
	

	
	
   //验证是否为空
   function checkString(src) {
		var srcname = src.id;
		var srctitle = src.title;
 		if (src.value=="") {
			$("#"+srcname+"_msg").css("color","#f00");
			$("#"+srcname+"_msg").text(srctitle+"不能空！");
			return false;
		}
		return true;
	}
	
   //验证是否为数字
   function checkNum(src) {
		var srcname = src.id;
		var srctitle = src.title;
 		if (isNaN(src.value)) {
			$("#"+srcname+"_msg").css("color","#f00");
			$("#"+srcname+"_msg").text(srctitle+"必须为数字！");
			return false;
		}
		return true;
	}
   
   //失去焦点验证
   function checkOk(src,isok){
	    var srcname = src.id;
		if (isok) {
			$("#"+srcname+"_msg").css("color","#060");
			$("#"+srcname+"_msg").html("<img src='${ctx}/images/chk_ok.jpg' border=0>");
		}
   }
   
   
	//表单提交验证
	function chkForm() {
		var  pjinfoId=$("#pjinfoId").find("option:selected").val();
		if(pjinfoId==""){
			isok = false;
			$("#pjinfoId_msg").css("color","#f00");
			$("#pjinfoId_msg").text("请选择评估项!");
		}else{
			$("#pjinfoId_msg").css("color","#060");
			$("#pjinfoId_msg").html("<img src='${ctx}/images/chk_ok.jpg' border=0>");
		}
		var isok = true;
		var content = document.getElementById("content");
		if (!checkString(content)) {
			isok = false;
		} 
		var weight = document.getElementById("weight");
		if (!(checkString(weight)&&checkNum(weight))) {
			isok = false;
		}
		var bak = document.getElementById("bak");
		if (!(checkString(bak)&&checkNum(bak))) {
			isok = false;
		}
		return isok;
	}
	
	function submitForm(){
		if(chkForm()){
			$.ajax({
				type : "POST",
				url : "${ctx}/pg/insertPjDetail",
				data : $("#form").serialize(),
				success : function(data) {
					closeiframe(window.name);
					refresh();
					parent.layer.msg(data,{time:2000});
				}
			});
		}
	}
</script>
</html>